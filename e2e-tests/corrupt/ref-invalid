#!/bin/bash

. e2e-tests/setup

rf x/files/foo echo abc
tb update $CFG

X## "Create invalid ref."
cat <<HERE >x/refs/bad-sha
{
 "sha256": "c5d982dc040081e09cad25209fed928b334a21fb2ff34db5202178a7b1a81988",
 "unixnano": 1749858394741289104
}
HERE
rx cat x/refs/bad-sha
run_and_verify 11 fsck $CFG
run_and_verify 10 update $CFG

X## "Create invalid ref."
cat <<HERE >x/refs/bad-sha
{
 "sha256": "c5d98",
 "unixnano": 1749858394741289104
}
HERE
rx cat x/refs/bad-sha
run_and_verify 11 fsck $CFG
